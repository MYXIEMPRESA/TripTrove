<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Mapa</title>
    <style>
        #map {
            position: right;
            top: 0;
            height: 100vh;
            width: 50vw;
        }

        #ruta-info {
            margin-top: 10px;
            position: flex;
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDXhXtV1rMD-5y15llNS1fFMl8u8TvVBoo&callback=initMap" async defer></script>
</head>
<body>

<div>
    <label for="modoViaje">Elegir modo de viaje:</label>
    <select id="modoViaje">
        <option value="WALKING">Caminando</option>
        <option value="DRIVING">Manejando</option>
    </select>
    <button onclick="iniciarRuta()">Iniciar Ruta</button>
</div>

<div id="map"></div>
<div id="ruta-info"></div>

<script>
    var lugares = [
        { nombre: "Centro Histórico de la CDMX", latitud: 19.4326, longitud: -99.1332 },
        { nombre: "Museo de Frida Kahlo", latitud: 19.3553, longitud: -99.1624 },
        { nombre: "Zoológico de Chapultepec", latitud: 19.4144, longitud: -99.1817 },
        { nombre: "Bosque de Chapultepec", latitud: 19.4203, longitud: -99.1815 },
        { nombre: "Xochimilco", latitud: 19.2460, longitud: -99.0851 },
        { nombre: "Museo Nacional de Antropología", latitud: 19.4269, longitud: -99.1871 },
        { nombre: "Museo Soumaya", latitud: 19.4401, longitud: -99.2047 },
        { nombre: "Parque México", latitud: 19.4101, longitud: -99.1726 }
        
    ];

    var directionsService, directionsRenderer;

    function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
            center: { lat: 19.4326, lng: -99.1332 },
            zoom: 12
        });

        directionsService = new google.maps.DirectionsService();
        directionsRenderer = new google.maps.DirectionsRenderer({ suppressMarkers: true, panel: document.getElementById('ruta-info') });
        directionsRenderer.setMap(map);

        //aqui me dice donde estoy
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                var userLocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                // para la felchita esa rara de mi ubi
                var userMarker = new google.maps.Marker({
                    position: userLocation,
                    map: map,
                    title: "Tu ubicación"
                });

                // la cosa esa de infowindow
                var infowindow = new google.maps.InfoWindow({
                    content: "Tu ubicación actual"
                });

                userMarker.addListener('click', function () {
                    infowindow.open(map, userMarker);
                });

                // Centrar el mapa en la ubicación actual del usuario
                map.setCenter(userLocation);
            });
        }

        lugares.forEach(function (lugar) {
            var marker = new google.maps.Marker({
                position: { lat: lugar.latitud, lng: lugar.longitud },
                map: map,
                title: lugar.nombre
            });

            var infowindow = new google.maps.InfoWindow({
                content: lugar.nombre
            });

            marker.addListener('click', function () {
                infowindow.open(map, marker);
                document.getElementById('ruta-info').innerHTML = '';
                var modoViaje = document.getElementById('modoViaje').value;
                calculateAndDisplayRoute({ lat: lugar.latitud, lng: lugar.longitud }, modoViaje);
            });
        });
    }

    function calculateAndDisplayRoute(destination, modo) {
        // Obtener la ubicación actual del usuario
        navigator.geolocation.getCurrentPosition(function (position) {
            var origin = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);

            var request = {
                origin: origin,
                destination: destination,
                travelMode: modo
            };

            directionsService.route(request, function (result, status) {
                if (status == 'OK') {
                    directionsRenderer.setDirections(result);
                } else {
                    window.alert('No se pudo calcular la ruta: ' + status);
                }
            });
        });
    }

    function iniciarRuta() {
        // Obtener la ubicación actual del usuario
        navigator.geolocation.getCurrentPosition(function (position) {
            var userLocation = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
            };

            var puntoB = lugares[0]; // Punto de destino (por ejemplo, el primer lugar en la lista)
            var modoViaje = document.getElementById('modoViaje').value;

            calculateAndDisplayRoute({ lat: puntoB.latitud, lng: puntoB.longitud }, modoViaje);
        });
        
    }
</script>

</body>
</html>
